var I=o=>{throw TypeError(o)};var f=(o,l,t)=>l.has(o)||I("Cannot "+t);var e=(o,l,t)=>(f(o,l,"read from private field"),t?t.call(o):l.get(o)),d=(o,l,t)=>l.has(o)?I("Cannot add the same private member more than once"):l instanceof WeakSet?l.add(o):l.set(o,t),y=(o,l,t,n)=>(f(o,l,"write to private field"),n?n.call(o,t):l.set(o,t),t);var a,c,h,r;class L extends ui.view.DefaultTheme.PropertyUI{constructor(){super();d(this,a);d(this,c);d(this,h);d(this,r);const t=y(this,a,core.PropertyTypes);this.btnCharmIncrease.on(Laya.Event.CLICK,this,this.onPropertyAllocate,[t.CHR,1]),this.btnCharmReduce.on(Laya.Event.CLICK,this,this.onPropertyAllocate,[t.CHR,-1]),this.btnIntelligenceIncrease.on(Laya.Event.CLICK,this,this.onPropertyAllocate,[t.INT,1]),this.btnIntelligenceReduce.on(Laya.Event.CLICK,this,this.onPropertyAllocate,[t.INT,-1]),this.btnStrengthIncrease.on(Laya.Event.CLICK,this,this.onPropertyAllocate,[t.STR,1]),this.btnStrengthReduce.on(Laya.Event.CLICK,this,this.onPropertyAllocate,[t.STR,-1]),this.btnMoneyIncrease.on(Laya.Event.CLICK,this,this.onPropertyAllocate,[t.MNY,1]),this.btnMoneyReduce.on(Laya.Event.CLICK,this,this.onPropertyAllocate,[t.MNY,-1]),this.inputCharm.on(Laya.Event.INPUT,this,this.onPropertyAllocateInput,[t.CHR]),this.inputIntelligence.on(Laya.Event.INPUT,this,this.onPropertyAllocateInput,[t.INT]),this.inputStrength.on(Laya.Event.INPUT,this,this.onPropertyAllocateInput,[t.STR]),this.inputMoney.on(Laya.Event.INPUT,this,this.onPropertyAllocateInput,[t.MNY]);const n=({currentTarget:i})=>{i.text=""};this.inputCharm.on(Laya.Event.MOUSE_DOWN,this,n),this.inputIntelligence.on(Laya.Event.MOUSE_DOWN,this,n),this.inputStrength.on(Laya.Event.MOUSE_DOWN,this,n),this.inputMoney.on(Laya.Event.MOUSE_DOWN,this,n),this.btnRandomAllocate.on(Laya.Event.CLICK,this,this.random),this.btnNext.on(Laya.Event.CLICK,this,this.next),this.listSelectedTalents.renderHandler=Laya.Handler.create(this,this.renderTalent,null,!1)}init({talents:t}){this.listSelectedTalents.array=t;const n=core.remake(t.map(i=>i.id));n.length>0&&$$event("message",[n.map(i=>["F_TalentReplace",i])]),y(this,c,core.getPropertyPoints()),y(this,r,core.propertyAllocateLimit),this.labLeftPropertyPoint.text=e(this,c),y(this,h,{[e(this,a).CHR]:0,[e(this,a).INT]:0,[e(this,a).STR]:0,[e(this,a).MNY]:0}),this.updateAllocate()}next(){const t=e(this,c)-this.total;if(t>0)return $$event("message",["F_PropertyPointLeft",t]);$ui.switchView(UI.pages.TRAJECTORY,{propertyAllocate:e(this,h),talents:this.listSelectedTalents.array,enableExtend:!0})}get total(){return e(this,h)[e(this,a).CHR]+e(this,h)[e(this,a).INT]+e(this,h)[e(this,a).STR]+e(this,h)[e(this,a).MNY]}updateAllocate(){const t=e(this,h)[e(this,a).CHR],n=e(this,h)[e(this,a).INT],i=e(this,h)[e(this,a).STR],s=e(this,h)[e(this,a).MNY];this.inputCharm.text=""+t,this.inputIntelligence.text=""+n,this.inputStrength.text=""+i,this.inputMoney.text=""+s,this.labLeftPropertyPoint.text=e(this,c)-this.total,this.btnCharmIncrease.disabled=this.btnCharmIncrease.gray=!1,this.btnCharmReduce.disabled=this.btnCharmReduce.gray=!1,this.btnIntelligenceIncrease.disabled=this.btnIntelligenceIncrease.gray=!1,this.btnIntelligenceReduce.disabled=this.btnIntelligenceReduce.gray=!1,this.btnStrengthIncrease.disabled=this.btnStrengthIncrease.gray=!1,this.btnStrengthReduce.disabled=this.btnStrengthReduce.gray=!1,this.btnMoneyIncrease.disabled=this.btnMoneyIncrease.gray=!1,this.btnMoneyReduce.disabled=this.btnMoneyReduce.gray=!1}check(t,n,i){return!(i<t||i>n)}random(){let t=e(this,c);const n=new Array(4).fill(e(this,r)[1]);for(;t>0;){const i=Math.round(Math.random()*(Math.min(t,e(this,r)[1])-1))+1;for(;;){const s=Math.floor(Math.random()*4)%4;if(!(n[s]-i<0)){n[s]-=i,t-=i;break}}}e(this,h)[e(this,a).CHR]=e(this,r)[1]-n[0],e(this,h)[e(this,a).INT]=e(this,r)[1]-n[1],e(this,h)[e(this,a).STR]=e(this,r)[1]-n[2],e(this,h)[e(this,a).MNY]=e(this,r)[1]-n[3],this.updateAllocate()}onPropertyAllocate(t,n){this.check(e(this,r)[0],e(this,r)[1],e(this,h)[t]+n)&&this.check(0,e(this,c),this.total+n)&&(e(this,h)[t]+=n,this.updateAllocate())}onPropertyAllocateInput(t,n){let i=parseInt(n.text)||0;const s=this.total;s+i<0?i=e(this,r)[0]*4-s:s+i>e(this,c)&&(i=e(this,c)-s),i<e(this,r)[0]?i=e(this,r)[0]:i>e(this,r)[1]&&(i=e(this,r)[1]);const p=i-e(this,h)[t];p?this.onPropertyAllocate(t,p):this.updateAllocate()}renderTalent(t){const n=t.dataSource;console.log("=== 属性页面渲染天赋 ==="),console.log("政策:",n.name),console.log("描述:",n.description),t.removeChildren(),t.height=80;const i=new Laya.Label;i.name="labName",i.width=t.width,i.height=35,i.y=10,i.align="center",i.valign="middle",i.font="SimHei",i.fontSize=62,i.color="#ffffff",i.text=n.name,t.addChild(i);const s=new Laya.Label;s.name="labDesc",s.width=t.width,s.height=25,s.y=45,s.align="center",s.valign="middle",s.font="SimHei",s.fontSize=0,s.color="#ffffff",s.text=`（${n.description}）`,t.addChild(s),Laya.timer.frameOnce(2,this,()=>{const u=t.width,g=i.contextWidth||i.width,m=s.contextWidth||s.width;i.x=Math.max(0,(u-g)/2),s.x=Math.max(0,(u-m)/2),console.log("属性页面居中完成:",{nameX:i.x,descX:s.x})});const p=$ui.common.card[n.grade].normal;$_.deepMapSet(t,p)}}a=new WeakMap,c=new WeakMap,h=new WeakMap,r=new WeakMap;export{L as default};
