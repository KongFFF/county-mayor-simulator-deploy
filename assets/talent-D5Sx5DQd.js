var f=l=>{throw TypeError(l)};var g=(l,h,e)=>h.has(l)||f("Cannot "+e);var c=(l,h,e)=>(g(l,h,"read from private field"),e?e.call(l):h.get(l)),m=(l,h,e)=>h.has(l)?f("Cannot add the same private member more than once"):h instanceof WeakSet?h.add(l):h.set(l,e);var a;class y extends ui.view.DefaultTheme.TalentUI{constructor(){super();m(this,a,new Set);this.btnDrawCard.on(Laya.Event.CLICK,this,this.onClickDrawCard),this.btnNext.on(Laya.Event.CLICK,this,this.onClickNext),this.listTalents.renderHandler=Laya.Handler.create(this,this.renderTalent,null,!1),this.listTalents.scrollBar.elasticDistance=150,this.listTalents.spaceY=80}init(){this.pageDrawCard.visible=!0,this.pageResult.visible=!1,this.btnNext.label="UI_Talent_Select_Uncomplete",c(this,a).clear()}close(){}onClickDrawCard(){this.pageDrawCard.visible=!1,this.pageResult.visible=!0,this.listTalents.array=core.talentRandom()}onClickNext(){if(c(this,a).size<core.talentSelectLimit)return $$event("message",["F_TalentSelectNotComplect",core.talentSelectLimit]);const e=[...c(this,a)].map(i=>this.listTalents.array[i]);$ui.switchView(UI.pages.PROPERTY,{talents:e,enableExtend:!0})}renderTalent(e,i){const t=e.dataSource;console.log("=== 彻底解决文字重叠问题 ==="),this.cleanAndRenderTalent(e,i,t)}cleanAndRenderTalent(e,i,t){const n=e.getChildByName("blank");e.height;const s=[];n&&s.push(n),e.removeChildren(),e.height=140,s.forEach(o=>{e.addChild(o)}),this.createTalentLabels(e,t),this.setupTalentStyleAndEvents(e,i,t,n),console.log("✅ 清理完成，box高度:",e.height)}createTalentLabels(e,i){const t=new Laya.Label;t.name="labName",t.width=e.width,t.height=50,t.y=25,t.align="center",t.valign="middle",t.font="SimHei",t.fontSize=56,t.color="#ffffff",t.text=i.name,e.addChild(t);const n=new Laya.Label;n.name="labDesc",n.width=e.width,n.height=40,n.y=85,n.align="center",n.valign="middle",n.font="SimHei",n.fontSize=38,n.color="#ffffff",n.text=`（${i.description}）`,e.addChild(n),console.log("✅ 文本组件创建完成，字体大小:",{名称:t.fontSize,描述:n.fontSize}),Laya.timer.frameOnce(2,this,()=>{const s=e.width,o=t.contextWidth||t.width,r=n.contextWidth||n.width;t.x=Math.max(0,(s-o)/2),n.x=Math.max(0,(s-r)/2)})}setupTalentStyleAndEvents(e,i,t,n){const s=$ui.common.card[t.grade],o=()=>{const r=c(this,a).has(i);n&&(n.pause=!r),$_.deepMapSet(e,r?s.selected:s.normal)};o(),e.offAll(Laya.Event.CLICK),e.on(Laya.Event.CLICK,this,()=>{if(c(this,a).has(i))c(this,a).delete(i);else{if(c(this,a).size>=core.talentSelectLimit)return $$event("message",["F_TalentSelectLimit",core.talentSelectLimit]);const r=core.exclude([...c(this,a)].map(d=>this.listTalents.array[d].id),this.listTalents.array[i].id);if(r!=null){for(const{name:d,id:T}of this.listTalents.array)if(r==T)return $$event("message",["F_TalentConflict",d]);return}c(this,a).add(i)}this.btnNext.label=c(this,a).size===core.talentSelectLimit?"UI_Next":"UI_Talent_Select_Uncomplete",o()})}setupTalentText(e,i,t,n){console.log("🎉 成功找到组件，设置文本"),e.text=t.name,i.text=`（${t.description}）`,e.y=35,i.y=85,Laya.timer.frameOnce(2,this,()=>{const s=n.width,o=e.contextWidth||e.width,r=i.contextWidth||i.width;e.x=(s-o)/2,i.x=(s-r)/2,console.log("居中完成:",{name:t.name,nameX:e.x,descX:i.x})})}fallbackToOldRender(e,i){console.log("❌ 找不到新组件，使用旧渲染");const t=e.getChildByName("label");t?t.text=$_.format($lang.F_TalentSelection,i):console.error("所有组件都找不到！")}}a=new WeakMap;export{y as default};
